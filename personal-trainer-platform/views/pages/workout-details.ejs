<%- include('../partials/header', { 
    title: 'Detalhes do Treino - FitConnect',
    bodyClass: 'dashboard-body'
}) %>

<header class="dashboard-header">
    <div class="dashboard-nav">
        <div class="nav-brand">
            <h2>FitConnect</h2>
        </div>
        <div class="nav-user">
            <span>Ol√°, <%= user.name %>!</span>
            <div class="user-menu">
                <form action="/auth/logout" method="POST" class="logout-form">
                    <button type="submit" class="btn btn-outline btn-sm">Sair</button>
                </form>
            </div>
        </div>
    </div>
</header>

<div class="dashboard-container">
    <aside class="dashboard-sidebar">
        <nav class="sidebar-nav">
            <% if (user.role === 'client') { %>
                <a href="/client/dashboard" class="nav-item">
                    <span>üìä</span> Dashboard
                </a>
                <a href="/client/workouts" class="nav-item">
                    <span>üí™</span> Meus Treinos
                </a>
                <a href="/client/chat" class="nav-item">
                    <span>üí¨</span> Chat
                </a>
            <% } else { %>
                <a href="/admin/dashboard" class="nav-item">
                    <span>üìä</span> Dashboard
                </a>
                <a href="/admin/clients" class="nav-item">
                    <span>üë•</span> Clientes
                </a>
                <a href="/admin/workouts/create" class="nav-item">
                    <span>üí™</span> Criar Treino
                </a>
            <% } %>
        </nav>
    </aside>

    <main class="dashboard-main">
        <div class="workout-details">
            <!-- Cabe√ßalho do Treino -->
            <div class="workout-header-section">
                <div class="workout-title-section">
                    <h1><%= workout.title %></h1>
                    <span class="workout-status active">Ativo</span>
                </div>
                <div class="workout-meta-info">
                    <div class="meta-item">
                        <strong>Criado por:</strong>
                        <span><%= user.role === 'client' ? workout.trainer_name : workout.client_name %></span>
                    </div>
                    <div class="meta-item">
                        <strong>Data:</strong>
                        <span><%= new Date(workout.created_at).toLocaleDateString('pt-BR') %></span>
                    </div>
                </div>
            </div>

            <!-- Descri√ß√£o -->
            <% if (workout.description) { %>
                <div class="section">
                    <h2>Descri√ß√£o</h2>
                    <p><%= workout.description %></p>
                </div>
            <% } %>

            <!-- Exerc√≠cios -->
            <div class="section">
                <h2>Exerc√≠cios</h2>
                <% if (exercises && exercises.length > 0) { %>
                    <div class="exercises-list">
                        <% exercises.forEach((exercise, index) => { %>
                            <div class="exercise-card">
                                <div class="exercise-header">
                                    <h3><%= exercise.name %></h3>
                                    <span class="exercise-sets"><%= exercise.sets %>x <%= exercise.reps %></span>
                                </div>
                                <% if (exercise.description) { %>
                                    <p class="exercise-desc"><%= exercise.description %></p>
                                <% } %>
                                <% if (exercise.rest) { %>
                                    <div class="exercise-meta">
                                        <span>Descanso: <%= exercise.rest %></span>
                                    </div>
                                <% } %>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <p>Nenhum exerc√≠cio definido para este treino.</p>
                    </div>
                <% } %>
            </div>

            <!-- Check-in Form (apenas para clientes) -->
            <% if (user.role === 'client') { %>
                <div class="section">
                    <h2>Registrar Check-in</h2>
                    <form class="checkin-form" id="checkinForm">
                        <input type="hidden" name="workout_id" value="<%= workout.id %>">
                        
                        <div class="form-group">
                            <label>Status do Treino</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="completed" value="true" checked>
                                    <span>‚úÖ Conclu√≠do</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="completed" value="false">
                                    <span>‚è≠Ô∏è N√£o Realizado</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="rating">Avalia√ß√£o</label>
                            <select id="rating" name="rating" required>
                                <option value="">Selecione uma avalia√ß√£o</option>
                                <option value="5">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è Excelente (5)</option>
                                <option value="4">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è Muito Bom (4)</option>
                                <option value="3">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è Bom (3)</option>
                                <option value="2">‚≠êÔ∏è‚≠êÔ∏è Regular (2)</option>
                                <option value="1">‚≠êÔ∏è Ruim (1)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="notes">Observa√ß√µes</label>
                            <textarea id="notes" name="notes" rows="4" 
                                      placeholder="Como foi o treino? Alguma dificuldade? Progresso observado?"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Registrar Check-in</button>
                    </form>
                </div>
            <% } %>

            <!-- Hist√≥rico de Check-ins -->
            <div class="section">
                <h2>Hist√≥rico de Check-ins</h2>
                <% if (checkins && checkins.length > 0) { %>
                    <div class="checkins-timeline">
                        <% checkins.forEach(checkin => { %>
                            <div class="checkin-item">
                                <div class="checkin-header">
                                    <div class="checkin-status <%= checkin.completed ? 'completed' : 'skipped' %>">
                                        <%= checkin.completed ? '‚úÖ Conclu√≠do' : '‚è≠Ô∏è Pulado' %>
                                    </div>
                                    <span class="checkin-date">
                                        <%= new Date(checkin.created_at).toLocaleDateString('pt-BR') %>
                                    </span>
                                </div>
                                <% if (checkin.rating) { %>
                                    <div class="checkin-rating">
                                        Avalia√ß√£o: 
                                        <% for (let i = 0; i < 5; i++) { %>
                                            <span class="star <%= i < checkin.rating ? 'filled' : '' %>">‚≠ê</span>
                                        <% } %>
                                        (<%= checkin.rating %>/5)
                                    </div>
                                <% } %>
                                <% if (checkin.notes) { %>
                                    <p class="checkin-notes"><%= checkin.notes %></p>
                                <% } %>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <p>Nenhum check-in registrado para este treino.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>
</div>

<script>
    // Formul√°rio de check-in
    document.getElementById('checkinForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const workoutId = formData.get('workout_id');

        try {
            const response = await fetch(`/client/workout/${workoutId}/checkin`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    completed: formData.get('completed') === 'true',
                    rating: parseInt(formData.get('rating')),
                    notes: formData.get('notes')
                })
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Check-in registrado com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                showNotification('Erro ao registrar check-in', 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showNotification('Erro ao registrar check-in', 'error');
        }
    });

    function showNotification(message, type) {
        // Implementa√ß√£o da notifica√ß√£o
        alert(`${type}: ${message}`);
    }
</script>

<style>
    .workout-details {
        max-width: 800px;
    }

    .workout-header-section {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .workout-title-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .workout-title-section h1 {
        margin: 0;
        color: #343a40;
    }

    .workout-meta-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .meta-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .meta-item strong {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .exercises-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .exercise-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }

    .exercise-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }

    .exercise-header h3 {
        margin: 0;
        color: #343a40;
    }

    .exercise-sets {
        background: #4361ee;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .exercise-desc {
        color: #6c757d;
        margin-bottom: 0.5rem;
    }

    .exercise-meta {
        font-size: 0.9rem;
        color: #6c757d;
    }

    .checkins-timeline {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .checkin-item {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }

    .checkin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .checkin-status.completed {
        color: #28a745;
        font-weight: 600;
    }

    .checkin-status.skipped {
        color: #dc2626;
        font-weight: 600;
    }

    .checkin-date {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .checkin-rating {
        margin-bottom: 0.5rem;
    }

    .star.filled {
        filter: brightness(1.2);
    }

    .checkin-notes {
        color: #6c757d;
        font-style: italic;
        margin: 0;
        padding: 0.75rem;
        background: #f8f9fa;
        border-radius: 4px;
    }
</style>

<%- include('../partials/footer') %>